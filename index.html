<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ash | Portfolio</title>

    <!-- tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:wght@400;600&family=Space+Grotesk:wght@400;600&display=swap"
        rel="stylesheet">

    <!-- jq -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- cool vid stuff -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

    <!-- my lovely css -->
    <link rel="stylesheet" href="assets/index.css">
    <style>
      .gradient-shine {
        background-image: linear-gradient(90deg, #e879f9, #d946ef, #a855f7);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        background-size: 200% 200%;
        animation: shine 12s linear infinite;
      }
      @keyframes shine {
        0% { background-position: 0% 50%; }
        100% { background-position: 100% 50%; }
      }
      .typewriter {
        position:relative;
        display:inline-block;
        vertical-align:bottom;
        color:#fff;
        min-width:1.2em; /* keep a stable inline-box */
      }
      .typewriter::after {
        content:"";
        position:absolute;
        right:-2px;
        top:10%;
        height:80%;
        width:2px;
        background:#fff;
        border-radius:1px;
        animation:blink .9s infinite ease-in-out;
      }
      @keyframes blink { 0%,100% { opacity:0; } 50% { opacity:1; } }
      @media (prefers-reduced-motion: reduce) {
        .typewriter::after { animation:none; }
      }
      @media (prefers-reduced-motion: reduce) {
        .typewriter { animation:none; border-right:none; }
      }
      .float-soft {
        animation: float 8s ease-in-out infinite;
      }
      @keyframes float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-8px); }
      }
      @media (prefers-reduced-motion: reduce) {
        .gradient-shine, .float-soft { animation: none; }
      }
    </style>
</head>

<body class="bg-neutral-950 text-white">
    <!-- nav -->
    <header class="fixed top-0 w-full z-50 backdrop-blur-md bg-white/5 border-b border-white/10">
        <nav class="max-w-6xl mx-auto flex items-center justify-between py-4 px-6">
            <h1 class="text-lg font-semibold tracking-tight">Ash.</h1>
            <div class="hidden md:flex gap-6 text-sm opacity-80">
                <a href="/about" class="hover:opacity-100 transition-opacity">About</a>
                <a href="#work" class="hover:opacity-100 transition-opacity">Work</a>
                <a href="#software" class="hover:opacity-100 transition-opacity">Software</a>
            </div>
        </nav>
    </header>

    <!-- top hero -->
    <section class="hero relative h-[70vh] flex items-center justify-center overflow-hidden">
        <video autoplay muted loop playsinline class="absolute inset-0 w-full h-full object-cover">
            <source src="./assets/grad.mp4" type="video/mp4" />
        </video>
        <div class="hero-content text-center px-6">
            <div class="glass px-8 py-6 rounded-2xl float-soft">
                <h2 class="text-4xl md:text-6xl font-semibold tracking-tight">
                  <span id="greeting" class="bg-clip-text typewriter">Hej</span><span>, I'm Ash.</span>
                </h2>
                <div class="mt-6 flex flex-wrap items-center justify-center gap-3">
                  <a href="#work" class="glass rounded-lg px-4 py-2 bg-white/10 hover:bg-white/20 transition text-white text-sm md:text-base">View Work</a>
                  <a href="#contact" class="glass rounded-lg px-4 py-2 bg-white/10 hover:bg-white/20 transition text-white text-sm md:text-base">Contact Me</a>
                  <a href="/about" class="glass rounded-lg px-4 py-2 bg-white/10 hover:bg-white/20 transition text-white text-sm md:text-base">About Me</a>
                </div>
            </div>
        </div>
</section>

    <!-- about -->
    <section id="about" class="max-w-3xl mx-auto py-16 px-6 fade-in opacity-0 translate-y-4 transition-all duration-700 ease-out text-center">
        <p class="text-neutral-300 text-lg leading-relaxed">
            I'm a media student with a strong passion for all things cameras.
        </p>
        <p class="mt-4 text-neutral-300 text-base leading-relaxed">
            I excel in editing, color grading, photography, and vision mixing.
        </p>
    </section>

    <!-- software -->
    <section id="software" class="max-w-5xl mx-auto py-10 px-6 fade-in opacity-0 translate-y-4 transition-all duration-700 ease-out">
        <h3 class="text-xl font-semibold mb-8 text-center">Software I Use</h3>
        <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-6 place-items-center">
            <div class="glass flex flex-col items-center justify-center aspect-square w-full max-w-[90px] p-3 transition hover:scale-105">
                <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/photoshop/photoshop-plain.svg"
                    class="software-icon w-8 h-8 mb-2" alt="Photoshop" loading="lazy" decoding="async">
                <p class="text-xs text-neutral-300">Photoshop</p>
            </div>
            <div class="glass flex flex-col items-center justify-center aspect-square w-full max-w-[90px] p-3 transition hover:scale-105">
                <img src="./assets/pr.png" class="software-icon w-8 h-8 mb-2" alt="Premiere" loading="lazy" decoding="async">
                <p class="text-xs text-neutral-300">Premiere</p>
            </div>
            <div class="glass flex flex-col items-center justify-center aspect-square w-full max-w-[90px] p-3 transition hover:scale-105">
                <img src="./assets/ae.png" class="software-icon w-8 h-8 mb-2" alt="After Effects" loading="lazy" decoding="async">
                <p class="text-xs text-neutral-300 text-center">After Effects</p>
            </div>
            <div class="glass flex flex-col items-center justify-center aspect-square w-full max-w-[90px] p-3 transition hover:scale-105">
                <img src="./assets/dvr.png" class="w-8 h-8 mb-2" alt="Resolve" loading="lazy" decoding="async">
                <p class="text-xs text-neutral-300">Resolve</p>
            </div>
            <div class="glass flex flex-col items-center justify-center aspect-square w-full max-w-[90px] p-3 transition hover:scale-105">
                <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/illustrator/illustrator-plain.svg"
                    class="software-icon w-8 h-8 mb-2" alt="Illustrator" loading="lazy" decoding="async">
                <p class="text-xs text-neutral-300">Illustrator</p>
            </div>
            <div class="glass flex flex-col items-center justify-center aspect-square w-full max-w-[90px] p-3 transition hover:scale-105">
                <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/figma/figma-original.svg"
                    class="software-icon w-8 h-8 mb-2" alt="Figma" loading="lazy" decoding="async">
                <p class="text-xs text-neutral-300">Figma</p>
            </div>
        </div>
    </section>

    <!-- gallery -->
    <section id="gallery" class="max-w-6xl mx-auto py-16 px-6 fade-in opacity-0 translate-y-4 transition-all duration-700 ease-out">
        <h3 class="text-xl font-semibold mb-8 text-center">Photo Gallery</h3>
        <div class="grid sm:grid-cols-2 md:grid-cols-3 gap-6">
            <div class="glass rounded-2xl overflow-hidden cursor-pointer gallery-item relative" data-full="./assets/photos/1.jpg" data-meta='{"brand":"Nikon","model":"Z fc","lens":"NIKKOR Z DX 16-50mm f/3.5-6.3 VR","iso":2000,"shutter":"1/125","aperture":"f/3.5"}'>
                <img src="./assets/photos/1.jpg" alt="Gallery 1" class="w-full h-48 object-cover select-none" loading="lazy" decoding="async">
                <img src="assets/photos/wm.png" alt="wm" class="absolute bottom-2 right-2 w-1/4 opacity-100 pointer-events-none select-none">
            </div>
            <div class="glass rounded-2xl overflow-hidden cursor-pointer gallery-item relative" data-full="./assets/photos/2.jpg" data-meta='{"brand":"Nikon","model":"Z fc","lens":"NIKKOR Z DX 16-50mm f/3.5-6.3 VR","iso":2000,"shutter":"1/125","aperture":"f/3.5"}'>
                <img src="./assets/photos/2.jpg" alt="Gallery 2" class="w-full h-48 object-cover select-none" loading="lazy" decoding="async">
                <img src="assets/photos/wm.png" alt="wm" class="absolute bottom-2 right-2 w-1/4 opacity-100 pointer-events-none select-none">
            </div>
            <div class="glass rounded-2xl overflow-hidden cursor-pointer gallery-item relative" data-full="./assets/photos/3.jpg" data-meta='{"brand":"Fujifilm","model":"GFX100S II","lens":"GF 80mm F1.7 R WR","iso":200,"shutter":"1/125","aperture":"f/8"}'>
                <img src="./assets/photos/3.jpg" alt="Gallery 3" class="w-full h-48 object-cover select-none" loading="lazy" decoding="async">
                <img src="assets/photos/wm.png" alt="wm" class="absolute bottom-2 right-2 w-1/4 opacity-100 pointer-events-none select-none">
            </div>
            <div class="glass rounded-2xl overflow-hidden cursor-pointer gallery-item relative" data-full="./assets/photos/4.jpg" data-meta='{"brand":"Canon","model":"EOS R50 Mirrorless","lens":"EF 50mm f/1.8 STM + Adapter","iso":100,"shutter":"1/500","aperture":"f/5"}'>
                <img src="./assets/photos/4.jpg" alt="Gallery 4" class="w-full h-48 object-cover select-none" loading="lazy" decoding="async">
                <img src="assets/photos/wm.png" alt="wm" class="absolute bottom-2 right-2 w-1/4 opacity-100 pointer-events-none select-none">
            </div>
            <div class="glass rounded-2xl overflow-hidden cursor-pointer gallery-item relative" data-full="./assets/photos/5.jpg" data-meta='{"brand":"Canon","model":"EOS R50 Mirrorless","lens":"EF 100mm f/2 USM + Adapter","iso":250,"shutter":"1/125","aperture":"f/7.1"}'>
                <img src="./assets/photos/5.jpg" alt="Gallery 5" class="w-full h-48 object-cover select-none" loading="lazy" decoding="async">
                <img src="assets/photos/wm.png" alt="wm" class="absolute bottom-2 right-2 w-1/4 opacity-100 pointer-events-none select-none">
            </div>
            <div class="glass rounded-2xl overflow-hidden cursor-pointer gallery-item relative" data-full="./assets/photos/6.jpg" data-meta='{"brand":"Canon","model":"EOS R50 Mirrorless","lens":"EF 100mm f/2 USM + Adapter","iso":800,"shutter":"1/1250","aperture":"f/2.8"}'>
                <img src="./assets/photos/6.jpg" alt="Gallery 6" class="w-full h-48 object-cover select-none" loading="lazy" decoding="async">
                <img src="assets/photos/wm.png" alt="wm" class="absolute bottom-2 right-2 w-1/4 opacity-100 pointer-events-none select-none">
            </div>
        </div>
    </section>

    <!-- projects -->
    <section id="work" class="max-w-6xl mx-auto py-16 px-6 fade-in opacity-0 translate-y-4 transition-all duration-700 ease-out">
        <h3 class="text-xl font-semibold mb-8 text-center">Projects</h3>
        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
            <div class="glass rounded-2xl overflow-hidden transition hover:-translate-y-1 hover:shadow-lg">
                <img src="assets/28sl.png" alt="28 Minutes Later" class="w-full h-auto object-cover" loading="lazy" decoding="async">
                <div class="p-4">
                    <h4 class="text-lg font-medium mb-1">28 Minutes Later</h4>
                    <p class="text-sm text-neutral-400">A short rendition of a 28 Days Later style film, made by our college class. Filmed by my classmates and edited in part by me and my classmate Abigail Pudney.</p>
                </div>
            </div>

            <div class="glass rounded-2xl overflow-hidden transition hover:-translate-y-1 hover:shadow-lg">
                <img src="assets/prem.png" alt="Premonition" class="w-full h-auto object-cover" loading="lazy" decoding="async">
                <div class="p-4">
                    <h4 class="text-lg font-medium mb-1">Premonition</h4>
                    <p class="text-sm text-neutral-400">A sci-fi short film made by MJC Productions. I edited and helped with set design, with Peterborough College's Game Design students making the VFX.</p>
                </div>
            </div>

            <div class="glass rounded-2xl overflow-hidden transition hover:-translate-y-1 hover:shadow-lg">
                <video controls preload="metadata" playsinline class="w-full h-auto object-cover plyr">
                    <source src="./assets/Mafia_Ash_Trailer2.mp4" type="video/mp4" />
                </video>
                <div class="p-4">
                    <h4 class="text-lg font-bold mb-1">MAFIA</h4>
                    <p class="text-sm text-neutral-400">A trailer for a short college film called Mafia, based on the childhood
                        game. Filmed on Blackmagic Ursa Mini 4K Pro cameras. Filmed and edited by me.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- showreel -->
    <section class="max-w-6xl mx-auto py-16 px-6 fade-in opacity-0 translate-y-4 transition-all duration-700 ease-out">
        <h3 class="text-3xl font-semibold mb-8 text-center">Showreel</h3>
        <div class="glass rounded-2xl overflow-hidden transition hover:-translate-y-1 hover:shadow-lg">
            <video controls preload="metadata" playsinline class="w-full h-auto object-cover plyr2">
                <source src="./assets/Showreel.mp4" type="video/mp4" />
            </video>
        </div>
    </section>

        <!-- contact -->
    <section id="contact" class="max-w-6xl mx-auto py-16 px-6 fade-in opacity-0 translate-y-4 transition-all duration-700 ease-out">
            <div class="glass rounded-2xl overflow-hidden transition hover:-translate-y-1 hover:shadow-lg">
                <div class="p-4">
                    <h4 class="text-xl font-medium mb-1">Get in touch!</h4>
                    <div class="flex items-center gap-3 text-md text-neutral-400">
                        <span>E:</span>
                        <button id="reveal-email" type="button" data-e="YXNoQGNhYXByb2R1Y3Rpb25zLnRlY2g=" class="underline hover:text-white">Press to reveal</button>
                        <a id="email-link" class="hidden underline hover:text-white" rel="noopener noreferrer"></a>
                        <button id="copy-email" type="button" class="hidden glass px-2 py-1 rounded text-xs">Copy</button>
                    </div>
                    <form id="contact-form" class="mt-6 grid sm:grid-cols-2 gap-4">
                        <input type="text" id="cf-name" name="name" placeholder="Your name" class="glass w-full rounded-lg px-3 py-2 bg-white/5 text-white placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-white/20" required>
                        <input type="email" id="cf-email" name="email" placeholder="Your email" class="glass w-full rounded-lg px-3 py-2 bg-white/5 text-white placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-white/20" required>
                        <textarea id="cf-message" name="message" placeholder="Your message" class="glass sm:col-span-2 w-full rounded-lg px-3 py-2 h-28 bg-white/5 text-white placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-white/20" required></textarea>
                        <input type="text" id="cf-website" name="website" class="hidden" autocomplete="off">
                        <input type="hidden" id="cf-start" name="start">
                        <button type="submit" class="sm:col-span-2 glass rounded-lg px-4 py-2 bg-white/10 hover:bg-white/20 transition text-white">Send</button>
                        <div id="cf-status" class="sm:col-span-2 text-sm text-neutral-300" aria-live="polite"></div>
                    </form>
                </div>
            </div>
    </section>

    <!-- footer -->
    <footer class="text-center py-8 text-neutral-500 text-xs fade-in">
        © <span id="year"></span> Ash. All rights reserved.
    </footer>

    <div id="lightbox" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center">
        <button id="lightbox-close" class="absolute top-5 right-5 glass px-3 py-1 rounded text-sm">Close</button>
        <div id="lightbox-meta" class="absolute top-5 left-5 right-24 text-neutral-200 bg-black/50 px-4 py-3 rounded-lg shadow hidden"></div>
        <canvas id="lightbox-canvas" class="rounded-lg shadow-lg"></canvas>
        <img id="lightbox-img" class="max-h-[80vh] max-w-[90vw] rounded-lg shadow-lg hidden object-contain" alt="Expanded image">
        <img id="lightbox-wm" src="assets/photos/wm.png" alt="wm" class="absolute bottom-3 right-3 w-1/4 opacity-60 pointer-events-none select-none hidden">
    </div>

    <!-- scripts -->
    <script>
    document.addEventListener('DOMContentLoaded',function(){
      var observer=new IntersectionObserver(function(entries){
        entries.forEach(function(e){
          if(e.isIntersecting){
            e.target.classList.remove('opacity-0','translate-y-4');
            e.target.classList.add('opacity-100','translate-y-0');
            observer.unobserve(e.target);
          }
        });
      },{threshold:0.12});
      document.querySelectorAll('.fade-in').forEach(function(el){
        observer.observe(el);
      });
      if(window.Plyr && !document.querySelector('.plyr__video-wrapper')){
        try{
          new Plyr('.plyr',{ratio:'16:9'});
          new Plyr('.plyr2',{ratio:'16:9'});
        }catch(_){}
      }
      var y=document.getElementById('year');
      if(y && !y.textContent){ y.textContent=new Date().getFullYear(); }
      // multilingual greeting
      var greetings=["Hej","Hello","Bonjour","Hola","Ciao","こんにちは","안녕하세요","Goedemiddag"];
      var idx=0;
      var el=document.getElementById('greeting');
      if(el){
        el.classList.add('blink'); // start blinking
        setInterval(function(){
          idx=(idx+1)%greetings.length;
          typeText(el,greetings[idx]);
        },4000);
        function typeText(el,newText){
          var oldArr=el.textContent.split('');
          var newArr=newText.split('');
          var speed=60; // ms per char
          // delete phase
          function del(i){
            if(i<0){ return add(0); }
            el.textContent=oldArr.slice(0,i).join('');
            setTimeout(function(){ del(i-1); },speed);
          }
          // add phase
          function add(i){
            if(i>newArr.length){ return; }
            el.textContent=newArr.slice(0,i).join('');
            setTimeout(function(){ add(i+1); },speed);
          }
          del(oldArr.length-1);
        }
      }
      var btn=document.getElementById('reveal-email');
      var link=document.getElementById('email-link');
      var copy=document.getElementById('copy-email');
      if(btn&&link&&copy){
        btn.addEventListener('click',function(){
          var e=btn.getAttribute('data-e');
          try{
            var addr=atob(e||'');
            link.textContent=addr;
            link.href='mailto:'+addr;
            btn.classList.add('hidden');
            link.classList.remove('hidden');
            copy.classList.remove('hidden');
          }catch(_){}
        });
        copy.addEventListener('click',function(){
          var t=link.textContent||'';
          if(!t) return;
          if(navigator.clipboard&&navigator.clipboard.writeText){
            navigator.clipboard.writeText(t).catch(function(){});
          }else{
            var ta=document.createElement('textarea');
            ta.value=t;document.body.appendChild(ta);ta.select();
            try{document.execCommand('copy');}catch(_){}
            document.body.removeChild(ta);
          }
        });
      }
      var cf=document.getElementById('contact-form');
      if(cf){
        var start=document.getElementById('cf-start');
        if(start){ start.value=Date.now(); }
        cf.addEventListener('submit',function(ev){
          ev.preventDefault();
          var name=document.getElementById('cf-name');
          var email=document.getElementById('cf-email');
          var msg=document.getElementById('cf-message');
          var hp=document.getElementById('cf-website');
          var status=document.getElementById('cf-status');
          var ok=true;
          if(hp && hp.value) ok=false;
          var elapsed=0; if(start){ elapsed=Date.now()-parseInt(start.value||'0'); }
          if(elapsed<1500) ok=false;
          if(!name || name.value.trim().length<2) ok=false;
          var em=(email && email.value.trim())||'';
          if(!email || !em.includes('@')) ok=false;
          if(!msg || msg.value.trim().length<10) ok=false;
          if(status){
            if(ok){
              status.textContent='Message ready (mock).';
              cf.reset();
              if(start){ start.value=Date.now(); }
            }else{
              status.textContent='Please check your details.';
            }
          }
        });
      }
      var lb=document.getElementById('lightbox');
      var lbImg=document.getElementById('lightbox-img');
      var lbCanvas=document.getElementById('lightbox-canvas');
      var lbWm=document.getElementById('lightbox-wm');
      var lbMeta=document.getElementById('lightbox-meta');
      var lbCtx=lbCanvas?lbCanvas.getContext('2d'):null;
      var lbClose=document.getElementById('lightbox-close');
      var wm=new Image(); wm.src='assets/photos/wm.png';
      var wmReady=false; wm.onload=function(){ wmReady=true; };
      var g=document.getElementById('gallery');
      [g, lb].forEach(function(node){ if(node){ node.addEventListener('contextmenu',function(e){ e.preventDefault(); },true); } });
      function xorEncode(str,key){ var out=''; for(var i=0;i<str.length;i++){ var c=str.charCodeAt(i) ^ key.charCodeAt(i%key.length); out+=('0'+c.toString(16)).slice(-2);} return out; }
      function xorDecode(hex,key){ var out=''; for(var i=0;i<hex.length;i+=2){ var b=parseInt(hex.substr(i,2),16); var c=b ^ key.charCodeAt((i/2)%key.length); out+=String.fromCharCode(c);} return out; }
      var key='ashwmkey';
      document.querySelectorAll('.gallery-item').forEach(function(card){
        var full=card.getAttribute('data-full');
        if(full){ var enc=xorEncode(full,key); card.setAttribute('data-xor',enc); card.removeAttribute('data-full'); }
      });
      document.querySelectorAll('.gallery-item').forEach(function(card){
        card.addEventListener('click',function(){
          var enc=card.getAttribute('data-xor');
          var full=enc?xorDecode(enc,key):(card.querySelector('img')?.src||'');
          var metaText='';
          var meta=card.getAttribute('data-meta');
          var brand=''; var details=''; var stats='';
          if(meta){
            try{
              var m=JSON.parse(meta);
              brand = m.brand || '';
              details = [m.model,m.lens].filter(Boolean).join(' • ');
              stats = ['ISO '+(m.iso||''),(m.shutter||''),(m.aperture||'')].filter(Boolean).join('  |  ');
              metaText = [brand,details,stats].filter(Boolean).join(' • ');
            }catch(_){}
          }
          if(!full||!lb) return;
          lb.classList.remove('hidden');
          if(lbWm){ lbWm.classList.remove('hidden'); }
          if(lbMeta){
            var esc=function(s){ return String(s).replace(/[&<>"']/g,function(ch){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'})[ch]; }); };
            if(brand){
              var second = [details,stats].filter(Boolean).join(' • ');
              lbMeta.innerHTML = '<div class="text-xl md:text-2xl font-semibold">'+esc(brand)+'</div>' + (second?'<div class="mt-1 text-xs md:text-sm text-neutral-300">'+esc(second)+'</div>':'');
            }else{
              lbMeta.textContent = metaText;
            }
            lbMeta.classList.remove('hidden');
          }
          // Draw via canvas with watermark; fallback to <img>
          if(lbCtx && lbCanvas){
            var drawBitmap=function(bitmap){
              var maxW=Math.floor(window.innerWidth*0.9);
              var maxH=Math.floor(window.innerHeight*0.8);
              var scale=Math.min(maxW/bitmap.width, maxH/bitmap.height, 1);
              var cw=Math.floor(bitmap.width*scale);
              var ch=Math.floor(bitmap.height*scale);
              lbCanvas.width=cw; lbCanvas.height=ch;
              lbImg.classList.add('hidden');
              lbCtx.clearRect(0,0,cw,ch);
              lbCtx.drawImage(bitmap,0,0,cw,ch);
              if(wmReady){
                var wmScale=Math.min(cw*0.2/wm.width, ch*0.2/wm.height);
                var ww=Math.floor(wm.width*wmScale);
                var wh=Math.floor(wm.height*wmScale);
                var pad=12;
                lbCtx.globalAlpha=0.5;
                lbCtx.drawImage(wm,cw-ww-pad,ch-wh-pad,ww,wh);
                lbCtx.globalAlpha=1;
              }
            };
            fetch(full,{mode:'cors'}).then(function(r){ return r.blob(); }).then(function(blob){
              if('createImageBitmap' in window){ return createImageBitmap(blob).then(drawBitmap); }
              return new Promise(function(resolve,reject){ var im=new Image(); im.onload=function(){ drawBitmap(im); resolve(); }; im.onerror=reject; im.src=URL.createObjectURL(blob); });
            }).catch(function(){ lbCanvas.width=0; lbCanvas.height=0; lbImg.src=full; lbImg.classList.remove('hidden'); });
          }else{
            lbImg.src=full;
            lbImg.classList.remove('hidden');
          }
          var onEsc=function(ev){ if(ev.key==='Escape'){ lb.classList.add('hidden'); if(lbWm){ lbWm.classList.add('hidden'); } if(lbMeta){ lbMeta.classList.add('hidden'); lbMeta.innerHTML=''; } document.removeEventListener('keydown',onEsc);} };
          document.addEventListener('keydown',onEsc);
        });
      });
      if(lb){
        lb.addEventListener('click',function(ev){ if(ev.target===lb){ lb.classList.add('hidden'); if(lbWm){ lbWm.classList.add('hidden'); } if(lbMeta){ lbMeta.classList.add('hidden'); lbMeta.innerHTML=''; } } });
      }
      if(lbClose && lb){ lbClose.addEventListener('click',function(){ lb.classList.add('hidden'); if(lbWm){ lbWm.classList.add('hidden'); } if(lbMeta){ lbMeta.classList.add('hidden'); lbMeta.innerHTML=''; } }); }
    });
    </script>
    <script src="./assets/pf.min.js"></script>
</body>

</html>

